<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<th:block>
    <h2>Chapter8. RAG(Retrieval-Augmented Generation)</h2><br>
    <h4>1. RAG(Retrieval-Augmented Generation)</h4><br>
    <p>Retrieval Augmented Generation(RAG)은 장문 콘텐츠, 사실적 정확성, 맥락 인식에 어려움을 겪는 대규모 언어 모델의 한계를 극복하는 데 유용한 기술입니다.</p>
    <p>관련 데이터를 프롬프트에 통합하여 정확한 AI 모델 응답을 도출하는 문제를 해결하기 위해 검색 증강 생성(RAG)이라는 기술이 등장했습니다.</p>
    <p>이 접근 방식은 배치 처리 방식의 프로그래밍 모델을 사용하는데, 작업이 문서에서 비정형 데이터를 읽어 변환한 다음 벡터 데이터베이스에 기록합니다. 간단히 말하면, 이는 ETL(추출, 변환, 로드) 파이프라인입니다. 벡터 데이터베이스는 RAG 기법의 검색 부분에서 사용됩니다.</p>
    <p>비정형 데이터를 벡터 데이터베이스에 로드하는 과정에서 가장 중요한 변환 작업 중 하나는 원본 문서를 더 작은 조각으로 분할하는 것입니다. 원본 문서를 더 작은 조각으로 분할하는 절차는 두 가지 중요한 단계로 구성됩니다.</p>
    <ol>
        <li>콘텐츠의 의미적 경계를 유지하면서 문서를 여러 부분으로 나눕니다. 예를 들어, 단락과 표가 있는 문서의 경우, 단락이나 표의 중간에서 문서를 나누지 않아야 합니다. 코드의 경우, 메서드 구현 중간에서 코드를 나누지 않아야 합니다.</li>
        <li>문서의 부분을 AI 모델의 토큰 제한의 작은 비율에 해당하는 크기로 다시 나눕니다.</li>
    </ol>
    <p>Spring AI는 API를 사용하여 사용자 정의 RAG 흐름을 직접 구축하거나 기본 RAG 흐름을 사용할 수 있는 모듈식 아키텍처를 제공하여 RAG를 지원합니다 Advisor.</p>
    <p>RAG의 다음 단계는 사용자 입력을 처리하는 것입니다. 사용자의 질문에 AI 모델이 답변해야 할 때, 질문과 모든 "유사한" 문서 조각들이 AI 모델로 전송되는 프롬프트에 배치됩니다. 이것이 벡터 데이터베이스를 사용하는 이유입니다. 벡터 데이터베이스는 유사한 콘텐츠를 찾는 데 매우 효과적입니다.</p>
    <img th:src="@{/imgs/rag2.png}" width="600px;"><br><a href="https://docs.spring.io/spring-ai/reference/api/tools.html">출처:docs.springai.io</a><br><br>
    <ul>
        <li>ETL 파이프라인은 데이터 소스에서 데이터 추출 흐름을 조율하고 이를 구조화된 벡터 저장소에 저장하는 방법에 대한 추가 정보를 제공하며, AI 모델에 데이터를 전달할 때 검색에 적합한 최적의 형식으로 데이터를 보장합니다.</li>
        <li>ChatClient - RAGQuestionAnswerAdvisor 에서는 애플리케이션에서 RAG 기능을 활성화하는 방법을 설명합니다 .</li>
    </ul><br>
    <h4>2. ETL Pipeline</h4>
    <p>추출, 변환, 로드(ETL) 프레임워크는 RAG(검색 증강 생성) 사용 사례 내에서 데이터 처리의 중추 역할을 합니다.</p>
    <p>ETL 파이프라인은 원시 데이터 소스에서 구조화된 벡터 저장소로의 흐름을 조율하여 AI 모델이 검색할 수 있도록 데이터가 최적의 형식인지 확인합니다.</p>
    <p>RAG 사용 사례는 데이터에서 관련 정보를 검색하여 생성된 출력의 품질과 관련성을 향상시킴으로써 생성 모델의 기능을 증강하는 텍스트입니다.</p>
    <img th:src="@{/imgs/etl.png}" width="600px;"><br><a href="https://docs.spring.io/spring-ai/reference/api/etl-pipeline.html">출처:docs.springai.io</a><br><br>
    <p>ETL 파이프라인은 Document인스턴스를 생성, 변환 및 저장합니다.</p>
    <p>이 Document클래스에는 텍스트, 메타데이터가 포함되어 있으며, 선택적으로 이미지, 오디오, 비디오와 같은 추가 미디어 유형도 포함됩니다.</p><br>
    <h4>3. Advisor를 이용한 RAG 구현</h4>
    <p>Spring AI는 다양한 Advisor API를 사용하여 일반적인 RAG 흐름에 대한 기본 지원을 제공합니다.</p>
    <p>QuestionAnswerAdvisor 및 다양한 Advisor를 제공 하며 Chapter 7.에서 진행 한 chat memory를 PGvector에 저장 하기 위한 VectorStoreChatMemoryAdvisor도 제공 하고 있습니다.</p>
    <p>다음은 RAG 구현을 위한 Spring Boot에서의 환경 설정 입니다.(yml)</p>
    <pre style="border:1px solid cornflowerblue">

        implementation 'org.springframework.ai:spring-ai-rag'
        implementation 'org.springframework.ai:spring-ai-advisors-vector-store'

        implementation 'org.springframework.ai:spring-ai-pdf-document-reader'
        implementation 'org.springframework.ai:spring-ai-tika-document-reader'
        implementation 'org.springframework.ai:spring-ai-jsoup-document-reader'
    </pre><br>
    <h4>4. QuestionAnswerAdvisor</h4>
    <p>벡터 데이터베이스는 AI 모델이 인지하지 못하는 데이터를 저장합니다. 사용자 질문이 AI 모델에 전송되면, AI QuestionAnswerAdvisor모델은 벡터 데이터베이스에 사용자 질문과 관련된 문서를 쿼리합니다.</p>
    <p>벡터 데이터베이스의 응답은 사용자 텍스트에 추가되어 AI 모델이 응답을 생성할 수 있는 컨텍스트를 제공합니다.</p>
    <p>이미 데이터를 에 로드했다고 가정하면 에 VectorStore인스턴스를 제공하여 검색 증강 생성(RAG)을 수행할 수 있습니다</p>
    <h4>5. RetrievalAugmentationAdvisor</h4>
    <p>Spring AI에는 RAG 플로우를 직접 구축하는 데 사용할 수 있는 RAG 모듈 라이브러리가RetrievalAugmentationAdvisor 포함되어 있습니다. 이는 Advisor모듈식 아키텍처를 기반으로 가장 일반적인 RAG 플로우를 즉시 구현할 수 있도록 지원합니다.</p>
    <p>기본적으로 는 RetrievalAugmentationAdvisor검색된 컨텍스트가 비어 있는 것을 허용하지 않습니다. 비어 있는 컨텍스트가 있으면 모델이 사용자 쿼리에 응답하지 않도록 지시합니다. 다음과 같이 비어 있는 컨텍스트를 허용할 수 있습니다.</p>
    <h4>6. Query Transformation</h4>
    <ol>
        <li>CompressionQueryTransformer: A는 CompressionQueryTransformer대규모 언어 모델을 사용하여 대화 기록과 후속 질문을 압축하여 대화의 핵심을 포착하는 독립적인 쿼리로 만듭니다.
            이 변환기는 대화 기록이 길고 후속 질문이 대화 맥락과 관련된 경우에 유용합니다.</li>
        <li>RewriteQueryTransformer: A는 RewriteQueryTransformer대규모 언어 모델을 사용하여 사용자 쿼리를 재작성함으로써 벡터 스토어 또는 웹 검색 엔진과 같은 대상 시스템에 쿼리할 때 더 나은 결과를 제공합니다.
            이 변환기는 사용자 쿼리가 장황하거나 모호하거나 검색 결과의 품질에 영향을 줄 수 있는 관련 없는 정보를 포함하는 경우에 유용합니다.</li>
        <li>TranslationQueryTransformer: A는 TranslationQueryTransformer대규모 언어 모델을 사용하여 쿼리를 문서 임베딩 생성에 사용된 임베딩 모델에서 지원하는 대상 언어로 번역합니다. 쿼리가 이미 대상 언어로 작성된 경우 변경 없이 그대로 반환됩니다. 쿼리의 언어를 알 수 없는 경우에도 마찬가지로 변경 없이 반환됩니다.
            이 변환기는 임베딩 모델이 특정 언어로 학습되었지만 사용자 쿼리가 다른 언어일 때 유용합니다.</li>
    </ol>
    <h4>7. Query Expansion</h4>
    <ol>
        <li>MultiQueryExpander: 이 방법은 MultiQueryExpander대규모 언어 모델을 사용하여 질의를 의미적으로 다양한 여러 변형으로 확장함으로써 다양한 관점을 포착하고, 추가적인 맥락 정보를 검색하고 관련성 있는 결과를 찾을 가능성을 높이는 데 유용합니다.</li>
    </ol>

</th:block>

</html>